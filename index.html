<!DOCTYPE html>
<html>
<head>
    <title>üîç Diagnostic Sheet.best</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f7fa; }
        .container { max-width: 800px; margin: auto; }
        .card { background: white; padding: 20px; margin: 10px 0; border-radius: 10px; border-left: 5px solid #ffb347; }
        button { background: #ffb347; border: none; padding: 10px 20px; border-radius: 30px; cursor: pointer; margin: 5px; }
        pre { background: #f0f0f0; padding: 15px; border-radius: 5px; overflow: auto; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç DIAGNOSTIC SHEET.BEST</h1>
        <p>URL : <code>https://api.sheetbest.com/sheets/70923d86-6d1a-4756-bf21-a869acf3e029</code></p>

        <div class="card">
            <h3>√âtape 1 : Tester la connexion</h3>
            <button onclick="testConnexion()">Tester la connexion</button>
        </div>

        <div class="card">
            <h3>√âtape 2 : V√©rifier chaque onglet</h3>
            <button onclick="verifierOnglet('eleves')">V√©rifier "eleves"</button>
            <button onclick="verifierOnglet('publications')">V√©rifier "publications"</button>
            <button onclick="verifierOnglet('cours')">V√©rifier "cours"</button>
            <button onclick="verifierOnglet('classes')">V√©rifier "classes"</button>
            <button onclick="verifierOnglet('administration')">V√©rifier "administration"</button>
            <button onclick="verifierOnglet('anciens')">V√©rifier "anciens"</button>
        </div>

        <div class="card">
            <h3>√âtape 3 : Ajouter des donn√©es de test</h3>
            <button onclick="ajouterTest('publications')">‚ûï Ajouter test dans "publications"</button>
            <button onclick="ajouterTest('cours')">‚ûï Ajouter test dans "cours"</button>
            <button onclick="ajouterTest('classes')">‚ûï Ajouter test dans "classes"</button>
            <button onclick="ajouterTest('administration')">‚ûï Ajouter test dans "administration"</button>
            <button onclick="ajouterTest('anciens')">‚ûï Ajouter test dans "anciens"</button>
        </div>

        <div class="card">
            <h3>R√©sultat :</h3>
            <pre id="resultat">Clique sur un bouton pour commencer...</pre>
        </div>
    </div>

    <script>
    const BASE_URL = 'https://api.sheetbest.com/sheets/70923d86-6d1a-4756-bf21-a869acf3e029';

    function afficher(message, type = 'info') {
        const pre = document.getElementById('resultat');
        pre.innerHTML = message;
        pre.className = type;
    }

    // √âtape 1 : Tester la connexion
    async function testConnexion() {
        afficher('‚è≥ Test de connexion...');
        try {
            const res = await fetch(BASE_URL);
            const data = await res.json();
            afficher(`‚úÖ Connexion r√©ussie !\n\nDonn√©es re√ßues :\n${JSON.stringify(data, null, 2)}`, 'success');
        } catch (err) {
            afficher(`‚ùå Erreur : ${err.message}`, 'error');
        }
    }

    // √âtape 2 : V√©rifier un onglet
    async function verifierOnglet(nom) {
        afficher(`‚è≥ V√©rification de l'onglet "${nom}"...`);
        
        try {
            const url = `${BASE_URL}#${nom}`;
            const res = await fetch(url);
            
            if (!res.ok) {
                afficher(`‚ùå L'onglet "${nom}" n'existe pas (code ${res.status})`, 'error');
                return;
            }
            
            const data = await res.json();
            
            if (Array.isArray(data)) {
                afficher(
                    `‚úÖ Onglet "${nom}" trouv√© !\n` +
                    `üìä ${data.length} √©l√©ment(s) pr√©sent(s)\n\n` +
                    `Structure des donn√©es :\n${JSON.stringify(data, null, 2)}`,
                    'success'
                );
            } else {
                afficher(`‚ö†Ô∏è L'onglet existe mais le format est √©trange :\n${JSON.stringify(data)}`, 'error');
            }
            
        } catch (err) {
            afficher(`‚ùå Erreur : ${err.message}`, 'error');
        }
    }

    // √âtape 3 : Ajouter des donn√©es de test
    async function ajouterTest(onglet) {
        let donnees = {};
        
        switch(onglet) {
            case 'publications':
                donnees = { titre: "Test " + Date.now(), contenu: "Ceci est un test" };
                break;
            case 'cours':
                donnees = { 
                    titre: "Cours test", 
                    professeur: "Prof Test", 
                    description: "Description test", 
                    type: "pdf", 
                    lien: "https://test.com" 
                };
                break;
            case 'classes':
                donnees = { nom: "Classe Test" };
                break;
            case 'administration':
                donnees = { nom: "Test Admin", role: "Testeur" };
                break;
            case 'anciens':
                donnees = { nom: "Test Ancien", annee: "2020", parcours: "Testeur" };
                break;
        }
        
        afficher(`‚è≥ Ajout d'un test dans "${onglet}"...`);
        
        try {
            const url = `${BASE_URL}#${onglet}`;
            const res = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify([donnees])
            });
            
            if (res.ok) {
                afficher(`‚úÖ Test ajout√© dans "${onglet}" !`, 'success');
                // V√©rifie automatiquement apr√®s 1 seconde
                setTimeout(() => verifierOnglet(onglet), 1000);
            } else {
                const text = await res.text();
                afficher(`‚ùå Erreur lors de l'ajout dans "${onglet}" :\n${text}`, 'error');
            }
        } catch (err) {
            afficher(`‚ùå Erreur : ${err.message}`, 'error');
        }
    }
    </script>
</body>
</html>

