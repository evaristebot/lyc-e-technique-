<!DOCTYPE html>
<html>
<head>
    <title>üß™ TEST √âL√àVES & COURS (avec suppression)</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f7fa; }
        .container { display: flex; gap: 20px; flex-wrap: wrap; }
        .card { 
            background: white; 
            padding: 20px; 
            border-radius: 15px; 
            flex: 1;
            min-width: 300px;
            border-left: 5px solid #ffb347;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        button { 
            background: #ffb347; 
            border: none; 
            padding: 10px 20px; 
            margin: 5px; 
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { background: #0b2f2f; color: #ffb347; }
        input, textarea, select { 
            width: 100%; 
            padding: 8px; 
            margin: 5px 0; 
            border: 2px solid #ddd; 
            border-radius: 10px;
        }
        .data-list { 
            margin-top: 15px; 
            max-height: 300px; 
            overflow-y: auto; 
            border-top: 2px solid #ffb347;
            padding-top: 10px;
        }
        .item { 
            background: #f0f0f0; 
            padding: 10px; 
            margin: 5px 0; 
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .delete-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
        }
        .delete-btn:hover { background: #cc0000; }
        code { background: #f0f0f0; padding: 2px 5px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üîç TEST √âL√àVES & COURS (avec suppression)</h1>

    <div class="container">
        <!-- Carte √âL√àVES -->
        <div class="card">
            <h2>üë®‚Äçüéì √âL√àVES</h2>
            <p><code>70923d86-6d1a-4756-bf21-a869acf3e029</code></p>
            
            <input type="text" id="eleveNom" placeholder="Nom">
            <input type="text" id="elevePrenom" placeholder="Pr√©nom">
            <input type="text" id="eleveClasse" placeholder="Classe">
            
            <button onclick="ajouterEleve()">‚ûï Ajouter √©l√®ve</button>
            <button onclick="voirEleves()">üìã Rafra√Æchir liste</button>
            
            <div id="listeEleves" class="data-list">
                Chargement...
            </div>
        </div>

        <!-- Carte COURS -->
        <div class="card">
            <h2>üìö COURS</h2>
            <p><code>0073e64e-80ab-4337-b6b9-df0c2ce14cd3</code></p>
            
            <input type="text" id="coursTitre" placeholder="Titre">
            <input type="text" id="coursProf" placeholder="Professeur">
            <textarea id="coursDesc" placeholder="Description" rows="2"></textarea>
            <select id="coursType">
                <option value="pdf">PDF</option>
                <option value="video">Vid√©o</option>
            </select>
            <input type="text" id="coursLien" placeholder="Lien">
            
            <button onclick="ajouterCours()">‚ûï Ajouter cours</button>
            <button onclick="voirCours()">üìã Rafra√Æchir liste</button>
            
            <div id="listeCours" class="data-list">
                Chargement...
            </div>
        </div>
    </div>

    <script>
    // ============================================
    // CONFIGURATION
    // ============================================
    const API = {
        eleves: 'https://api.sheetbest.com/sheets/70923d86-6d1a-4756-bf21-a869acf3e029',
        cours: 'https://api.sheetbest.com/sheets/0073e64e-80ab-4337-b6b9-df0c2ce14cd3'
    };

    // ============================================
    // FONCTIONS POUR LES √âL√àVES
    // ============================================
    async function voirEleves() {
        const liste = document.getElementById('listeEleves');
        liste.innerHTML = 'Chargement...';
        
        try {
            const res = await fetch(API.eleves);
            const data = await res.json();
            
            if (data.length === 0) {
                liste.innerHTML = '<p>Aucun √©l√®ve</p>';
                return;
            }
            
            let html = '';
            data.forEach((eleve, index) => {
                // Sheet.best utilise l'index de la ligne (commence √† 1)
                const ligneId = index + 1;
                html += `
                    <div class="item">
                        <span>
                            üë§ <strong>${eleve.nom || ''}</strong> 
                            ${eleve['pr√©nom '] || eleve.prenom || ''} 
                            - ${eleve['classe '] || eleve.classe || ''}
                        </span>
                        <button class="delete-btn" onclick="supprimerEleve(${ligneId})">üóëÔ∏è Supprimer</button>
                    </div>
                `;
            });
            liste.innerHTML = html;
        } catch (err) {
            liste.innerHTML = `‚ùå Erreur: ${err.message}`;
        }
    }

    async function ajouterEleve() {
        const nom = document.getElementById('eleveNom').value.trim();
        const prenom = document.getElementById('elevePrenom').value.trim();
        const classe = document.getElementById('eleveClasse').value.trim();
        
        if (!nom || !prenom || !classe) {
            alert('‚ùå Tous les champs sont requis');
            return;
        }
        
        try {
            const res = await fetch(API.eleves, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify([{ nom, prenom, classe }])
            });
            
            if (res.ok) {
                alert('‚úÖ √âl√®ve ajout√© !');
                document.getElementById('eleveNom').value = '';
                document.getElementById('elevePrenom').value = '';
                document.getElementById('eleveClasse').value = '';
                voirEleves();
            } else {
                alert('‚ùå Erreur lors de l\'ajout');
            }
        } catch (err) {
            alert('‚ùå Erreur: ' + err.message);
        }
    }

    async function supprimerEleve(ligneId) {
        if (!confirm(`Supprimer l'√©l√®ve √† la ligne ${ligneId} ?`)) return;
        
        try {
            const res = await fetch(`${API.eleves}/${ligneId}`, {
                method: 'DELETE'
            });
            
            if (res.ok) {
                alert('‚úÖ √âl√®ve supprim√© !');
                voirEleves();
            } else {
                alert('‚ùå Erreur lors de la suppression');
            }
        } catch (err) {
            alert('‚ùå Erreur: ' + err.message);
        }
    }

    // ============================================
    // FONCTIONS POUR LES COURS
    // ============================================
    async function voirCours() {
        const liste = document.getElementById('listeCours');
        liste.innerHTML = 'Chargement...';
        
        try {
            const res = await fetch(API.cours);
            const data = await res.json();
            
            if (data.length === 0) {
                liste.innerHTML = '<p>Aucun cours</p>';
                return;
            }
            
            let html = '';
            data.forEach((cours, index) => {
                const ligneId = index + 1;
                html += `
                    <div class="item">
                        <span>
                            üìò <strong>${cours.titre || ''}</strong> 
                            - ${cours.professeur || ''}<br>
                            <small>${cours.type || ''}</small>
                        </span>
                        <button class="delete-btn" onclick="supprimerCours(${ligneId})">üóëÔ∏è Supprimer</button>
                    </div>
                `;
            });
            liste.innerHTML = html;
        } catch (err) {
            liste.innerHTML = `‚ùå Erreur: ${err.message}`;
        }
    }

    async function ajouterCours() {
        const titre = document.getElementById('coursTitre').value.trim();
        const prof = document.getElementById('coursProf').value.trim();
        const desc = document.getElementById('coursDesc').value.trim();
        const type = document.getElementById('coursType').value;
        const lien = document.getElementById('coursLien').value.trim();
        
        if (!titre || !prof || !desc || !lien) {
            alert('‚ùå Tous les champs sont requis');
            return;
        }
        
        try {
            const res = await fetch(API.cours, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify([{ 
                    titre: titre, 
                    professeur: prof, 
                    description: desc, 
                    type: type, 
                    lien: lien 
                }])
            });
            
            if (res.ok) {
                alert('‚úÖ Cours ajout√© !');
                document.getElementById('coursTitre').value = '';
                document.getElementById('coursProf').value = '';
                document.getElementById('coursDesc').value = '';
                document.getElementById('coursLien').value = '';
                voirCours();
            } else {
                alert('‚ùå Erreur lors de l\'ajout');
            }
        } catch (err) {
            alert('‚ùå Erreur: ' + err.message);
        }
    }

    async function supprimerCours(ligneId) {
        if (!confirm(`Supprimer le cours √† la ligne ${ligneId} ?`)) return;
        
        try {
            const res = await fetch(`${API.cours}/${ligneId}`, {
                method: 'DELETE'
            });
            
            if (res.ok) {
                alert('‚úÖ Cours supprim√© !');
                voirCours();
            } else {
                alert('‚ùå Erreur lors de la suppression');
            }
        } catch (err) {
            alert('‚ùå Erreur: ' + err.message);
        }
    }

    // Charger les donn√©es au d√©marrage
    voirEleves();
    voirCours();
    </script>
</body>
</html>
