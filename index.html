<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Test Sheet.best - LycÃ©e Technique</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial; padding: 20px; background: #f5f7fa; }
  .container { max-width: 800px; margin: auto; }
  button { 
    background: #ffb347; 
    border: none; 
    padding: 12px 25px; 
    margin: 10px; 
    border-radius: 30px;
    cursor: pointer;
    font-weight: bold;
  }
  pre { 
    background: white; 
    padding: 15px; 
    border-radius: 10px; 
    border-left: 5px solid #ffb347;
    white-space: pre-wrap;
  }
  .success { color: green; font-weight: bold; }
  .error { color: red; font-weight: bold; }
</style>
</head>
<body>
<div class="container">
  <h1>ğŸ§ª TEST SHEET.BEST</h1>
  <p>URL : <code>https://api.sheetbest.com/sheets/70923d86-6d1a-4756-bf21-a869acf3e029</code></p>

  <div>
    <button onclick="testLecture('eleves')">ğŸ“– Lire Ã©lÃ¨ves</button>
    <button onclick="testLecture('publications')">ğŸ“– Lire publications</button>
    <button onclick="testLecture('cours')">ğŸ“– Lire cours</button>
    <button onclick="testLecture('classes')">ğŸ“– Lire classes</button>
    <button onclick="testLecture('administration')">ğŸ“– Lire administration</button>
    <button onclick="testLecture('anciens')">ğŸ“– Lire anciens</button>
  </div>

  <div style="margin-top:20px;">
    <h3>â• Ajouter un Ã©lÃ¨ve test</h3>
    <input type="text" id="testNom" placeholder="Nom" value="Test">
    <input type="text" id="testPrenom" placeholder="PrÃ©nom" value="Sheet">
    <input type="text" id="testClasse" placeholder="Classe" value="TestClasse">
    <button onclick="testAjoutEleve()">AJOUTER</button>
  </div>

  <div id="resultat">
    <pre>Clique sur un bouton pour commencer...</pre>
  </div>
</div>

<script>
const BASE_URL = 'https://api.sheetbest.com/sheets/70923d86-6d1a-4756-bf21-a869acf3e029';

function afficherResultat(message, type = 'info') {
  const pre = document.querySelector('#resultat pre');
  const color = type === 'success' ? 'green' : (type === 'error' ? 'red' : '#333');
  pre.innerHTML = message;
  pre.style.color = color;
  pre.style.borderLeftColor = type === 'success' ? 'green' : (type === 'error' ? 'red' : '#ffb347');
}

async function testLecture(onglet) {
  afficherResultat(`â³ Chargement de l'onglet "${onglet}"...`);
  
  try {
    const url = `${BASE_URL}/${onglet}`;
    console.log('ğŸ“¡ RequÃªte:', url);
    
    const response = await fetch(url);
    const data = await response.json();
    
    afficherResultat(
      `âœ… Onglet "${onglet}" :\n` +
      `ğŸ“Š ${data.length} Ã©lÃ©ment(s) trouvÃ©(s)\n\n` +
      JSON.stringify(data, null, 2),
      'success'
    );
  } catch (err) {
    afficherResultat(`âŒ Erreur : ${err.message}`, 'error');
    console.error(err);
  }
}

async function testAjoutEleve() {
  const nom = document.getElementById('testNom').value.trim();
  const prenom = document.getElementById('testPrenom').value.trim();
  const classe = document.getElementById('testClasse').value.trim();

  if (!nom || !prenom || !classe) {
    afficherResultat('âŒ Tous les champs sont requis', 'error');
    return;
  }

  afficherResultat(`â³ Ajout de ${nom} ${prenom}...`);

  try {
    const response = await fetch(`${BASE_URL}/eleves`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify([{ nom, prenom, classe }])
    });

    const result = await response.json();
    
    afficherResultat(
      `âœ… Ajout rÃ©ussi !\n\nRÃ©ponse :\n${JSON.stringify(result, null, 2)}`,
      'success'
    );

    // Recharge automatiquement la liste des Ã©lÃ¨ves aprÃ¨s 2 secondes
    setTimeout(() => testLecture('eleves'), 2000);

  } catch (err) {
    afficherResultat(`âŒ Erreur : ${err.message}`, 'error');
    console.error(err);
  }
}

// Test de connexion au dÃ©marrage
window.onload = async function() {
  try {
    const response = await fetch(BASE_URL);
    const data = await response.json();
    afficherResultat(
      'âœ… Connexion rÃ©ussie Ã  Sheet.best !\n' +
      `ğŸ“Š DonnÃ©es actuelles : ${data.length} Ã©lÃ©ment(s) dans la feuille principale.\n\n` +
      'Clique sur un bouton pour lire un onglet spÃ©cifique.',
      'success'
    );
  } catch (err) {
    afficherResultat(`âŒ Erreur de connexion : ${err.message}`, 'error');
  }
};
</script>
</body>
</html>
