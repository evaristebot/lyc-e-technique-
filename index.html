<!DOCTYPE html>
<html>
<head>
    <title>üîç Test Airtable</title>
</head>
<body>
    <h1>üîç Test de connexion Airtable</h1>
    <p>Base ID : <code>appkY3jjhpeE3qIoM</code></p>
    <p>Token : <code>patjrQeZt0hXPQ7ry.3edbbab760fa151d...</code></p>

    <button onclick="testerConnexion()">üìã Tester la connexion</button>
    <button onclick="lireEleves()">üë®‚Äçüéì Lire les √©l√®ves</button>
    <button onclick="ajouterEleve()">‚ûï Ajouter un √©l√®ve test</button>

    <pre id="resultat" style="background:#f0f0f0; padding:15px; margin-top:20px; border-radius:5px;"></pre>

    <script>
    
    const baseId = 'appkY3jjhpeE3qIoM';
    const tableName = '√âleves';

    function afficher(data) {
        document.getElementById('resultat').innerHTML = JSON.stringify(data, null, 2);
    }

    async function testerConnexion() {
        try {
            const res = await fetch(`https://api.airtable.com/v0/${baseId}/${encodeURIComponent(tableName)}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const data = await res.json();
            afficher({ status: res.status, ok: res.ok, data });
        } catch (err) {
            afficher({ error: err.message });
        }
    }

    async function lireEleves() {
        try {
            const res = await fetch(`https://api.airtable.com/v0/${baseId}/${encodeURIComponent(tableName)}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const data = await res.json();
            afficher(data);
        } catch (err) {
            afficher({ error: err.message });
        }
    }

    async function ajouterEleve() {
        const nouvelEleve = {
            records: [{
                fields: {
                    "Nom": "Test",
                    "Pr√©nom": "Airtable",
                    "Contact parents": "699000000"
                }
            }]
        };

        try {
            const res = await fetch(`https://api.airtable.com/v0/${baseId}/${encodeURIComponent(tableName)}`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(nouvelEleve)
            });
            const data = await res.json();
            afficher({ success: true, data });
        } catch (err) {
            afficher({ error: err.message });
        }
    }
    </script>
</body>
</html>
