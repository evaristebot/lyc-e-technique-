<!DOCTYPE html>
<html>
<head>
  <title>Test Supabase</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f7fa;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin: 20px 0;
    }
    button {
      background: #ffb347;
      color: #0b2f2f;
      border: none;
      padding: 12px 25px;
      border-radius: 25px;
      font-weight: bold;
      cursor: pointer;
      margin: 5px;
    }
    .success { color: green; font-weight: bold; }
    .error { color: red; font-weight: bold; }
    pre {
      background: #f0f0f0;
      padding: 10px;
      border-radius: 5px;
      overflow: auto;
    }
  </style>
</head>
<body>
  <h1>üîç Test de connexion Supabase</h1>
  
  <div class="card">
    <h3>Configuration</h3>
    <p><strong>URL:</strong> https://cxvetkmbhohutyprwxjx.supabase.co</p>
    <p><strong>Cl√© API:</strong> sb_publishable_o5PsuBWUwgad235AnF6hqg_5E47LM1C</p>
  </div>

  <div class="card">
    <h3>Actions</h3>
    <button onclick="testConnexion()">1Ô∏è‚É£ Tester la connexion</button>
    <button onclick="testInsertion()">2Ô∏è‚É£ Tester l'insertion</button>
    <button onclick="testLecture()">3Ô∏è‚É£ Tester la lecture</button>
  </div>

  <div class="card">
    <h3>R√©sultat</h3>
    <div id="resultat" style="min-height: 100px;">
      Clique sur un bouton pour commencer
    </div>
  </div>

  <script>
    // Configuration Supabase
    const supabaseUrl = 'https://cxvetkmbhohutyprwxjx.supabase.co';
    const supabaseKey = 'sb_publishable_o5PsuBWUwgad235AnF6hqg_5E47LM1C';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    const resultDiv = document.getElementById('resultat');

    function afficher(message, type = 'info') {
      const className = type === 'success' ? 'success' : (type === 'error' ? 'error' : '');
      resultDiv.innerHTML = `<p class="${className}">${message}</p>`;
    }

    async function testConnexion() {
      afficher('‚è≥ Test de connexion en cours...');
      
      try {
        // Test simple : on essaie de lire la table specialites
        const { data, error } = await supabase
          .from('specialites')
          .select('count', { count: 'exact', head: true });
        
        if (error) {
          afficher(`‚ùå Erreur de connexion : ${error.message}`, 'error');
          console.error(error);
        } else {
          afficher('‚úÖ Connexion r√©ussie ! La table specialites est accessible.', 'success');
        }
      } catch (err) {
        afficher(`‚ùå Exception : ${err.message}`, 'error');
      }
    }

    async function testInsertion() {
      const nomTest = 'Test_' + Date.now();
      afficher(`‚è≥ Tentative d'insertion de "${nomTest}"...`);
      
      try {
        const { data, error } = await supabase
          .from('specialites')
          .insert([{ nom: nomTest }])
          .select();
        
        if (error) {
          afficher(`‚ùå Erreur d'insertion : ${error.message}`, 'error');
          console.error(error);
        } else {
          afficher(`‚úÖ Insertion r√©ussie ! Donn√©e ajout√©e : ${JSON.stringify(data)}`, 'success');
        }
      } catch (err) {
        afficher(`‚ùå Exception : ${err.message}`, 'error');
      }
    }

    async function testLecture() {
      afficher('‚è≥ Lecture des donn√©es...');
      
      try {
        const { data, error } = await supabase
          .from('specialites')
          .select('*')
          .limit(10);
        
        if (error) {
          afficher(`‚ùå Erreur de lecture : ${error.message}`, 'error');
          console.error(error);
        } else {
          if (data && data.length > 0) {
            let html = '‚úÖ Donn√©es lues avec succ√®s :<br><pre>' + 
                      JSON.stringify(data, null, 2) + '</pre>';
            afficher(html, 'success');
          } else {
            afficher('‚úÖ Connexion r√©ussie mais aucune donn√©e trouv√©e', 'success');
          }
        }
      } catch (err) {
        afficher(`‚ùå Exception : ${err.message}`, 'error');
      }
    }
  </script>
</body>
</html>
